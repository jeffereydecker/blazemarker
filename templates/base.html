<!doctype html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta name="description" content="Fun for family and friends">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Blazemarker</title>

<!-- PWA Meta Tags -->
<meta name="theme-color" content="#667eea">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Blazemarker">
<link rel="manifest" href="/static/manifest.json">

<!-- Favicons -->
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<!-- PWA App Icons -->
<link rel="apple-touch-icon" sizes="72x72" href="/static/icons/icon-72x72.png">
<link rel="apple-touch-icon" sizes="96x96" href="/static/icons/icon-96x96.png">
<link rel="apple-touch-icon" sizes="128x128" href="/static/icons/icon-128x128.png">
<link rel="apple-touch-icon" sizes="144x144" href="/static/icons/icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/static/icons/icon-152x152.png">
<link rel="apple-touch-icon" sizes="192x192" href="/static/icons/icon-192x192.png">
<link rel="apple-touch-icon" sizes="384x384" href="/static/icons/icon-384x384.png">
<link rel="apple-touch-icon" sizes="512x512" href="/static/icons/icon-512x512.png">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<link href="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.snow.css" rel="stylesheet">
<link rel="stylesheet" href="/css/blazemarker.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!--
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
-->
<link rel="canonical" href="https://blazemarker.com/">


{{ template "scripts" . }}

</head>

<body class="blazemarker-bg-body">

  <div class="container">
    <header class="blazemarker-header py-3">
      <h1 class="text-center"><a class="blazemarker-header-logo" href="/">Blazemarker</a></h1>

      <nav class="navbar navbar-expand-sm navbar-dark blazemarker-bg-primary sticky-top">
	<!--   <a class="navbar-brand" href="." >Blazemarker</a
	       >
	  -->

	<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
	  <span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse justify-content-sm-center" id="navbarContent">
	  <ul class="navbar-nav  navbar-nav-scroll" style="--bs-scroll-height: 120px;">
            <li class="nav-item">
	      <a class="nav-link active" href="/gallery">Photos</a>
	    </li>
	    <li class="nav-item">
	      <a class="nav-link active" href="/articles">Articles</a>
	    </li>
	    <li class="nav-item">
	      <a class="nav-link active" href="/profile">Profile</a>
	    </li>
	  </ul>
	</div>
      </nav>
    </header>
  </div>

  {{ template "nav_body" . }}

  <!-- Online Users Widget -->
  <div id="online-users-widget" style="position: fixed; bottom: 20px; right: 20px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); padding: 15px; min-width: 200px; max-width: 300px; z-index: 1000; display: none;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 2px solid #667eea; padding-bottom: 8px;">
      <h6 style="margin: 0; color: #667eea; font-weight: 600;">ðŸŸ¢ Online Users</h6>
      <button id="close-online-widget" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #888; line-height: 1;">&times;</button>
    </div>
    <div id="online-users-list" style="max-height: 300px; overflow-y: auto;">
      <p style="color: #888; font-size: 14px; text-align: center;">Loading...</p>
    </div>
  </div>

  <!-- Toggle button for online users -->
  <button id="toggle-online-users" style="position: fixed; bottom: 20px; right: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 50%; width: 56px; height: 56px; font-size: 24px; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 999; display: flex; align-items: center; justify-content: center;">
    ðŸ‘¥
  </button>

  <script>
    // Online users functionality
    (function() {
      const widget = document.getElementById('online-users-widget');
      const toggle = document.getElementById('toggle-online-users');
      const closeBtn = document.getElementById('close-online-widget');
      const usersList = document.getElementById('online-users-list');

      let isWidgetOpen = false;

      function toggleWidget() {
        isWidgetOpen = !isWidgetOpen;
        if (isWidgetOpen) {
          widget.style.display = 'block';
          toggle.style.display = 'none';
          fetchOnlineUsers();
        } else {
          widget.style.display = 'none';
          toggle.style.display = 'flex';
        }
      }

      function fetchOnlineUsers() {
        fetch('/api/users/online')
          .then(response => response.json())
          .then(users => {
            if (users.length === 0) {
              usersList.innerHTML = '<p style="color: #888; font-size: 14px; text-align: center;">No users online</p>';
            } else {
              usersList.innerHTML = users.map(user => {
                const timeAgo = getTimeAgo(user.last_seen);
                const isCurrent = user.is_current_user ? ' (you)' : '';
                return `
                  <div style="display: flex; align-items: center; padding: 8px; border-bottom: 1px solid #f0f0f0;">
                    <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%; margin-right: 10px;"></div>
                    <div style="flex: 1;">
                      <div style="font-weight: 600; color: #333; font-size: 14px;">${user.handle || user.username}${isCurrent}</div>
                      <div style="font-size: 12px; color: #888;">${timeAgo}</div>
                    </div>
                  </div>
                `;
              }).join('');
            }
          })
          .catch(error => {
            console.error('Failed to fetch online users:', error);
            usersList.innerHTML = '<p style="color: #dc3545; font-size: 14px; text-align: center;">Failed to load</p>';
          });
      }

      function getTimeAgo(dateString) {
        if (!dateString) return 'Just now';
        const date = new Date(dateString);
        const now = new Date();
        const seconds = Math.floor((now - date) / 1000);
        
        if (seconds < 60) return 'Just now';
        if (seconds < 120) return '1 minute ago';
        if (seconds < 3600) return Math.floor(seconds / 60) + ' minutes ago';
        if (seconds < 7200) return '1 hour ago';
        return Math.floor(seconds / 3600) + ' hours ago';
      }

      toggle.addEventListener('click', toggleWidget);
      closeBtn.addEventListener('click', toggleWidget);

      // Auto-refresh every 30 seconds when widget is open
      setInterval(() => {
        if (isWidgetOpen) {
          fetchOnlineUsers();
        }
      }, 30000);
    })();
  </script>

  <!-- PWA Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/service-worker.js')
          .then((registration) => {
            console.log('Service Worker registered:', registration.scope);
            
            // Check for updates periodically
            setInterval(() => {
              registration.update();
            }, 60000); // Check every minute
          })
          .catch((error) => {
            console.error('Service Worker registration failed:', error);
          });
      });

      // Listen for service worker updates
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        console.log('New service worker activated, reloading...');
        window.location.reload();
      });
    }

    // Handle install prompt for PWA
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      // Prevent the mini-infobar from appearing on mobile
      e.preventDefault();
      // Store the event for later use
      deferredPrompt = e;
      // Could show a custom install button here
      console.log('PWA install prompt available');
    });

    window.addEventListener('appinstalled', () => {
      console.log('PWA was installed');
      deferredPrompt = null;
    });
  </script>
   
</body>

</html>
